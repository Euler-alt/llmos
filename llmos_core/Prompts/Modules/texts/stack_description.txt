{
  "module": "StackPromptModule",
  "description": "Stack 模块管理一个函数式栈（stack of frames），每个帧记录 name、description、variables、fail_reason、content。LLM 通过调用函数与栈交互。",
  "call_type": "stack",
  "functions": [
    {
      "name": "stack_push",
      "description": "创建并压入一个新栈帧。",
      "parameters": {
        "name": "string (可选, 默认自动生成唯一名)",
        "description": "string (可选, 栈帧说明, 默认空字符串)",
        "variables": "dict (可选, 用于存储临时上下文变量)"
      },
      "return": {
        "success": {"status": "ok", "stack_size": "N"},
        "error": {"status": "error", "reason": "invalid arguments"}
      },
      "example_call": {
        "call_type": "stack",
        "func_name": "stack_push",
        "kwargs": {"name": "plan_route", "description": "规划路线", "variables": {"city": "Tokyo"}}
      }
    },
    {
      "name": "stack_pop",
      "description": "弹出栈顶帧并（可选）携带结果返回。",
      "parameters": {
        "result": "any (可选, 表示函数返回值或执行结果)"
      },
      "return": {
        "success": {"status": "ok", "popped": "frame_name", "result": "...", "stack_size": "N"},
        "error": {"status": "error", "reason": "stack empty"}
      },
      "example_call": {
        "call_type": "stack",
        "func_name": "stack_pop",
        "kwargs": {"result": "finished"}
      }
    },
    {
      "name": "stack_append",
      "description": "将文本内容追加到当前栈顶帧的 content 字段（用于日志/中间信息）。",
      "parameters": {
        "content": "string (必选)"
      },
      "return": {
        "success": {"status": "ok", "new_content": "..."},
        "error": {"status": "error", "reason": "no active frame"}
      },
      "example_call": {
        "call_type": "stack",
        "func_name": "stack_append",
        "kwargs": {"content": "找到候选A"}
      }
    },
    {
      "name": "stack_replace",
      "description": "替换当前栈顶帧的 description、variables，并设置 fail_reason（通常用于错误回溯/重试）。",
      "parameters": {
        "description": "string (可选)",
        "variables": "dict (可选)",
        "fail_reason": "string (可选, 默认 'unknown failure')"
      },
      "return": {
        "success": {"status": "ok", "replaced": "frame_name", "fail_reason": "..."},
        "error": {"status": "error", "reason": "no active frame"}
      },
      "example_call": {
        "call_type": "stack",
        "func_name": "stack_replace",
        "kwargs": {"description": "重新规划路线", "variables": {"city": "Kyoto"}, "fail_reason": "路径不可行"}
      }
    }
  ],
  "forward_format": {
    "description": "当内核需要把当前栈作为 prompt 的一部分时，栈会被序列化为如下格式，多帧按顺序拼接。",
    "frame_format": "Function <frame_name>: <frame_description>\nVariables: <json of variables>\n[Previous failure: <fail_reason>] (可选)\n<content> (可选)"
  },
  "usage_examples": [
    {
      "action": "压入栈帧",
      "call": {"call_type": "stack", "func_name": "stack_push", "kwargs": {"name": "plan_route", "description": "规划路线", "variables": {"city": "Tokyo"}}}
    },
    {
      "action": "追加日志",
      "call": {"call_type": "stack", "func_name": "stack_append", "kwargs": {"content": "找到候选A"}}
    },
    {
      "action": "替换帧信息",
      "call": {"call_type": "stack", "func_name": "stack_replace", "kwargs": {"description": "重新规划路线", "variables": {"city": "Kyoto"}, "fail_reason": "路径不可行"}}
    },
    {
      "action": "弹出栈帧",
      "call": {"call_type": "stack", "func_name": "stack_pop", "kwargs": {"result": "成功找到最优路径"}}
    }
  ],
  "notes": [
    "建议优先使用 JSON 调用格式，避免简写导致解析错误。",
    "所有返回结果必须是 JSON-able 的 dict。",
    "典型流程：push -> append(s) -> pop；失败时可用 replace 修正当前帧后重试。"
  ]
}
