{
"module": "StackPromptModule",
"description": "Stack 模块用于管理 LLM 的任务执行流程和分层规划（Task Execution Context）。每个栈帧代表一个子任务或过程，用于存储该任务的局部参数（variables）和关键进展（content）。",
"call_type": "prompt",
"functions": [
 {
 "name": "stack_push",
 "description": "开始一个新子任务，创建并压入一个任务上下文帧。",
 "parameters": {
  "name": "string (可选, 默认自动生成唯一名)",
  "description": "string (可选, 子任务目标的简短说明)",
  "variables": "dict (可选, 仅用于存储当前子任务的关键输入参数或局部状态。严禁存储冗余的环境观测数据。)"
 },
 "return": {
  "success": {"status": "ok", "stack_size": "N"},
  "error": {"status": "error", "reason": "invalid arguments"}
 },
 "example_call": {
  "call_type": "prompt",
  "func_name": "stack_push",
  "kwargs": {"name": "find_item", "description": "寻找台灯（desklamp）", "variables": {"target": "desklamp", "rooms_checked": []}}
 }
 },
 {
 "name": "stack_pop",
 "description": "结束当前子任务，弹出栈顶帧并（可选）携带结果返回父任务。",
 "parameters": {
  "result": "any (可选, 表示子任务的返回值或执行结果，例如 'success' 或 'item_found')"
 },
 "return": {
  "success": {"status": "ok", "popped": "frame_name", "result": "...", "stack_size": "N"},
  "error": {"status": "error", "reason": "stack empty"}
 },
 "example_call": {
  "call_type": "prompt",
  "func_name": "stack_pop",
  "kwargs": {"result": "desklamp_found"}
 }
 },
 {
 "name": "stack_append",
 "description": "将原子性的、非冗余的进展日志追加到栈顶帧的 content 字段。此字段是审计追踪记录点，内容将累积，严禁将思考过程或环境状态文本追加到此字段。",
 "parameters": {
  "content": "string (必选) - 必须是新的、一句话的、精简的日志条目，用于记录关键发现或行动完成。"
 },
 "return": {
  "success": {"status": "ok", "new_content": "..."},
  "error": {"status": "error", "reason": "no active frame"}
 },
 "example_call": {
  "call_type": "prompt",
  "func_name": "stack_append",
  "kwargs": {"content": "LOG: Successfully moved to the dresser."}
 }
 },
 {
 "name": "stack_replace",
 "description": "更新当前栈顶帧的 description、variables，并设置 fail_reason。通常用于错误回溯或在同一子任务内进行重试或策略修正。",
 "parameters": {
  "description": "string (可选, 新的任务目标描述)",
  "variables": "dict (可选, 更新局部变量)",
  "fail_reason": "string (可选, 默认 'unknown failure')"
 },
 "return": {
  "success": {"status": "ok", "replaced": "frame_name", "fail_reason": "..."},
  "error": {"status": "error", "reason": "no active frame"}
 },
 "example_call": {
  "call_type": "prompt",
  "func_name": "stack_replace",
  "kwargs": {"description": "切换目标：改在架子上寻找台灯", "variables": {"search_location": "shelf"}, "fail_reason": "Dresser was empty."}
 }
 }
],
"forward_format": {
 "description": "当内核需要把当前栈作为 prompt 的一部分时，栈会被序列化为如下格式，多帧按顺序拼接。请根据此格式来理解你的当前任务上下文。",
 "frame_format": "Function <frame_name>: <frame_description>\nVariables: <json of variables>\n[Previous failure: <fail_reason>] (可选)\n<content> (可选)"
},
"usage_examples": [
 {
 "action": "开始任务",
 "call": {"call_type": "prompt", "func_name": "stack_push", "kwargs": {"name": "main_task", "description": "examine the pillow with the desklamp", "variables": {"step": "1/3: Get Desklamp"}}}
 },
 {
 "action": "记录进展",
 "call": {"call_type": "prompt", "func_name": "stack_append", "kwargs": {"content": "LOG: Desklamp successfully picked up."}}
 },
 {
 "action": "子任务失败后重试",
 "call": {"call_type": "prompt", "func_name": "stack_replace", "kwargs": {"description": "重新规划寻找路径", "variables": {"retry_count": 1}, "fail_reason": "Initial search failed."}}
 },
 {
 "action": "完成任务",
 "call": {"call_type": "prompt", "func_name": "stack_pop", "kwargs": {"result": "Task Finished: True"}}
 }
],
"notes": [
 "建议优先使用 JSON 调用格式，避免简写导致解析错误。",
 "所有返回结果必须是 JSON-able 的 dict。",
 "典型流程：push -> append(s) -> pop；失败时可用 replace 修正当前帧后重试。",
 "[K-RULE 关键语义约束]: 栈是任务流程管理器，而非思考或聊天记录。严格遵守以下规则：\n1. stack_push/pop 必须对应任务的开始和结束。\n2. variables 只能存储局部参数。\n3. content 只能通过 stack_append 写入原子性进展日志，严禁包含思考过程、推理或重复信息。"
]
}